const JOKES=[{setup:"Why did the OSINT analyst break up with Google?",punchline:"Because Google was tracking them back."},{setup:"What's the difference between an OSINT investigator and a stalker?",punchline:"A LinkedIn premium subscription."},{setup:"My therapist says I need to stop investigating people online.",punchline:"Interesting... Tell me more about your background, Dr. Williams."},{setup:"Why do OSINT analysts make terrible poker players?",punchline:"They already Googled everyone's tells before the game started."},{setup:"How many OSINT analysts does it take to change a lightbulb?",punchline:"None. They found the maintenance schedule in an exposed bucket."},{setup:"What did the metadata say to the photo?",punchline:'"You look anonymous, but I know exactly where and when you were taken."'},{setup:"Why do OSINT investigators love the Wayback Machine?",punchline:"Because the internet never forgets."},{setup:"What's the OSINT analyst's bedtime story?",punchline:'"Once upon a time, someone reused the same username everywhere. The end."'},{setup:"What's the scariest thing an investigator can say?",punchline:'"I found your old MySpace page."'},{setup:"OSINT Rule #1: Everything is findable. Rule #2:",punchline:"You probably should not have posted that."},{setup:"Why did Jessica Jones switch to digital investigations?",punchline:"Because you can drink whiskey during WHOIS lookups and nobody judges."},{setup:"What's worse than getting breached?",punchline:'Finding out your password was "password123".'}],TIPS=["Google dorking is not an insult. Try: site:target.com filetype:pdf","The Wayback Machine never forgets, even if they deleted it.","EXIF data: because your photos are snitches.","Reuse of usernames is one of the fastest pivots in OSINT.","Reverse image search is often the shortest path to identity correlation.","Public records are public. Treat findings responsibly and lawfully.","crt.sh can reveal overlooked subdomains via certificate history.","DNS records are often more honest than marketing pages.","OSINT is about discovering what is already public, not exposing private data.","Track your pivots. Investigations fail when context gets lost.","Use multiple search engines. Indexes differ.","Confidence scoring beats guesswork in long investigations."],TAGLINES=["Investigating the internet, one query at a time...","Privacy is a feature, not a bug.","Powered by curiosity and too much caffeine.","Open source intelligence, closed source paranoia.","Because every investigation starts with a question."],FOOTER_JOKES=["Remember: It's not stalking if it's public data.","No EXIF data was harmed in the making of this toolkit.","This app has trust issues. Correctly.","No servers were contacted unless you explicitly asked for it.","Operational security is a mindset, not a toggle."],LOADING_MESSAGES=["Booting surveillance systems...","Calibrating search algorithms...","Warming up regex engines...","Loading field notes...","Preparing secure local workspace..."],STORAGE_KEYS={entities:"spin_entities",activePanel:"spin_active_panel",theme:"spin_theme",installDismissed:"spin_install_dismissed"},BOOKMARKS={"Search Engines":[{name:"Google",url:"https://google.com",desc:"Web search with advanced operators"},{name:"DuckDuckGo",url:"https://duckduckgo.com",desc:"Privacy-focused search"},{name:"Bing",url:"https://bing.com",desc:"Microsoft search engine"},{name:"Yandex",url:"https://yandex.com",desc:"Useful for reverse image searches"}],"People Search":[{name:"Pipl",url:"https://pipl.com",desc:"People search engine"},{name:"WhitePages",url:"https://whitepages.com",desc:"Phone and address lookup"},{name:"TruePeopleSearch",url:"https://truepeoplesearch.com",desc:"Free people search"}],"Social Media":[{name:"Namechk",url:"https://namechk.com",desc:"Username availability checker"},{name:"KnowEm",url:"https://knowem.com",desc:"Username search across many sites"},{name:"Social Blade",url:"https://socialblade.com",desc:"Social media analytics"}],"Domain & IP":[{name:"Shodan",url:"https://shodan.io",desc:"Internet-connected device search"},{name:"Censys",url:"https://search.censys.io",desc:"Internet scanning intelligence"},{name:"VirusTotal",url:"https://virustotal.com",desc:"File, URL, IP analysis"},{name:"crt.sh",url:"https://crt.sh",desc:"Certificate transparency search"},{name:"Wayback Machine",url:"https://web.archive.org",desc:"Historical web snapshots"}],"Image & Media":[{name:"TinEye",url:"https://tineye.com",desc:"Reverse image search"},{name:"Google Images",url:"https://images.google.com",desc:"Image search and reverse lookup"},{name:"FotoForensics",url:"https://fotoforensics.com",desc:"Image forensics and metadata"}],"Email & Phone":[{name:"Have I Been Pwned",url:"https://haveibeenpwned.com",desc:"Breach exposure checks"},{name:"Epieos",url:"https://epieos.com",desc:"Email OSINT helper"},{name:"NumLookup",url:"https://numlookup.com",desc:"Phone lookup utility"}],Geolocation:[{name:"Google Maps",url:"https://maps.google.com",desc:"Maps and Street View"},{name:"SunCalc",url:"https://suncalc.org",desc:"Sun position and shadow analysis"},{name:"Wikimapia",url:"https://wikimapia.org",desc:"Collaborative mapping"}]},USERNAME_PLATFORMS=[{key:"github",name:"GitHub",icon:"GH",profileUrl:e=>`https://github.com/${encodeURIComponent(e)}`,check:async e=>{const t=await fetchWithTimeout(`https://api.github.com/users/${encodeURIComponent(e)}`,{},8e3);return 200===t.status?{status:"exists",message:"Profile found"}:404===t.status?{status:"missing",message:"Profile not found"}:{status:"error",message:`HTTP ${t.status}`}}},{key:"gitlab",name:"GitLab",icon:"GL",profileUrl:e=>`https://gitlab.com/${encodeURIComponent(e)}`,check:async e=>{const t=await fetchWithTimeout(`https://gitlab.com/api/v4/users?username=${encodeURIComponent(e)}`,{},8e3);if(!t.ok)return{status:"error",message:`HTTP ${t.status}`};const a=await t.json();return Array.isArray(a)&&a.length?{status:"exists",message:"Profile found"}:{status:"missing",message:"Profile not found"}}},{key:"reddit",name:"Reddit",icon:"RD",profileUrl:e=>`https://reddit.com/user/${encodeURIComponent(e)}`,check:async e=>{const t=await fetchWithTimeout(`https://www.reddit.com/user/${encodeURIComponent(e)}/about.json`,{headers:{Accept:"application/json"}},9e3);return 200===t.status?{status:"exists",message:"Profile found"}:404===t.status?{status:"missing",message:"Profile not found"}:{status:"error",message:`HTTP ${t.status}`}}},{key:"keybase",name:"Keybase",icon:"KB",profileUrl:e=>`https://keybase.io/${encodeURIComponent(e)}`,check:async e=>{const t=await fetchWithTimeout(`https://keybase.io/_/api/1.0/user/lookup.json?usernames=${encodeURIComponent(e)}`,{},9e3);if(!t.ok)return{status:"error",message:`HTTP ${t.status}`};const a=await t.json();return(a?.them||[]).length?{status:"exists",message:"Profile found"}:{status:"missing",message:"Profile not found"}}},{key:"devto",name:"Dev.to",icon:"DV",profileUrl:e=>`https://dev.to/${encodeURIComponent(e)}`,check:async e=>{const t=await fetchWithTimeout(`https://dev.to/api/users/by_username?url=${encodeURIComponent(e)}`,{},9e3);return 200===t.status?{status:"exists",message:"Profile found"}:404===t.status?{status:"missing",message:"Profile not found"}:{status:"error",message:`HTTP ${t.status}`}}},{key:"docker",name:"Docker Hub",icon:"DK",profileUrl:e=>`https://hub.docker.com/u/${encodeURIComponent(e)}`,check:async e=>{const t=await fetchWithTimeout(`https://hub.docker.com/v2/users/${encodeURIComponent(e)}`,{},9e3);return 200===t.status?{status:"exists",message:"Profile found"}:404===t.status?{status:"missing",message:"Profile not found"}:{status:"error",message:`HTTP ${t.status}`}}},{key:"x",name:"Twitter/X",icon:"X",profileUrl:e=>`https://x.com/${encodeURIComponent(e)}`},{key:"instagram",name:"Instagram",icon:"IG",profileUrl:e=>`https://instagram.com/${encodeURIComponent(e)}`},{key:"linkedin",name:"LinkedIn",icon:"LI",profileUrl:e=>`https://linkedin.com/in/${encodeURIComponent(e)}`},{key:"tiktok",name:"TikTok",icon:"TT",profileUrl:e=>`https://www.tiktok.com/@${encodeURIComponent(e)}`},{key:"youtube",name:"YouTube",icon:"YT",profileUrl:e=>`https://youtube.com/@${encodeURIComponent(e)}`},{key:"telegram",name:"Telegram",icon:"TG",profileUrl:e=>`https://t.me/${encodeURIComponent(e)}`}],COUNTRY_CODES={1:{name:"United States/Canada",format:"(XXX) XXX-XXXX"},44:{name:"United Kingdom",format:"0XXXX XXXXXX"},33:{name:"France",format:"0X XX XX XX XX"},49:{name:"Germany",format:"0XXX XXXXXXXX"},61:{name:"Australia",format:"0X XXXX XXXX"},81:{name:"Japan",format:"0XX-XXXX-XXXX"},86:{name:"China",format:"0XXX-XXXX-XXXX"},91:{name:"India",format:"0XXXXX XXXXX"},7:{name:"Russia",format:"8 (XXX) XXX-XX-XX"},55:{name:"Brazil",format:"(XX) XXXXX-XXXX"},52:{name:"Mexico",format:"XX XXXX XXXX"},34:{name:"Spain",format:"XXX XX XX XX"},39:{name:"Italy",format:"XXX XXX XXXX"}},appState={activePanel:"dashboard",jokeOrder:[],jokeCursor:-1,currentJokeIndex:-1,tipOrder:[],tipCursor:-1,tipPopupTimer:null,tickerInterval:null,tickerPaused:!1,deferredInstallPrompt:null,sessionStart:Date.now(),usernameChecksRunning:!1,externalRequests:0,robotsCache:new Map},byId=e=>document.getElementById(e),qsa=(e,t=document)=>Array.from(t.querySelectorAll(e)),shuffle=e=>{const t=e.slice();for(let e=t.length-1;e>0;e-=1){const a=Math.floor(Math.random()*(e+1));[t[e],t[a]]=[t[a],t[e]]}return t},delay=e=>new Promise(t=>setTimeout(t,e)),pad2=e=>e<10?`0${e}`:`${e}`,safeJsonParse=(e,t)=>{try{return JSON.parse(e)}catch(e){return t}},escapeHtml=e=>{const t=document.createElement("div");return t.textContent=String(e),t.innerHTML},escapeAttr=e=>escapeHtml(e).replace(/"/g,"&quot;").replace(/'/g,"&#39;"),debounce=(e,t=200)=>{let a=null;return(...s)=>{a&&clearTimeout(a),a=setTimeout(()=>e(...s),t)}},formatDate=e=>{if(!e)return"-";const t=new Date(e);return Number.isNaN(t.getTime())?"-":`${t.getFullYear()}-${pad2(t.getMonth()+1)}-${pad2(t.getDate())}`},fetchWithTimeout=async(e,t={},a=1e4)=>{const s=new AbortController,n=setTimeout(()=>s.abort(),a);try{return await fetch(e,{...t,signal:s.signal})}finally{clearTimeout(n)}},markExternalRequest=()=>{appState.externalRequests+=1,updateSecurityStatus()};let toastTimer=null;const showToast=(e,t="success")=>{const a=byId("toast");a&&(a.textContent=e,a.className=`toast show ${t}`,toastTimer&&clearTimeout(toastTimer),toastTimer=setTimeout(()=>{a.className="toast",toastTimer=null},3200))},setHint=(e,t="",a="info")=>{const s=byId(e);s&&(s.textContent=t,s.className=`input-hint ${a}`.trim())},renderLoading=(e,t="Analyzing locally...")=>{const a=byId(e);a&&(a.innerHTML=`\n    <div class="loading-skeleton">\n      <span class="inline-spinner" aria-hidden="true"></span>\n      <span>${escapeHtml(t)}</span>\n    </div>\n  `)},copyToClipboard=async e=>{try{if(navigator.clipboard?.writeText)await navigator.clipboard.writeText(e);else{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove()}showToast("Copied to clipboard.")}catch(e){showToast("Could not copy to clipboard.","error")}},normalizeEntityValue=(e,t)=>{const a=String(t).trim();switch(e){case"email":return a.toLowerCase();case"domain":return a.toLowerCase().replace(/^https?:\/\//i,"").split("/")[0];case"phone":return a.replace(/[^\d+]/g,"");default:return a}},getEntities=()=>safeJsonParse(localStorage.getItem(STORAGE_KEYS.entities)||"[]",[]),setEntities=e=>{localStorage.setItem(STORAGE_KEYS.entities,JSON.stringify(e))},updateEntityCount=()=>{const e=getEntities(),t=byId("entity-count"),a=byId("entity-types-count");if(t&&(t.textContent=`${e.length}`),a){const t=new Set(e.map(e=>e.type));a.textContent=`${t.size}`}},saveEntity=(e,t,a="Manual")=>{const s=getEntities(),n=normalizeEntityValue(e,t),i=(new Date).toISOString(),o=s.find(t=>t.type===e&&t.value===n);o?(o.count=(o.count||1)+1,o.lastSeen=i,a&&!o.sources.includes(a)&&o.sources.push(a)):s.push({id:`${Date.now().toString(36)}${Math.random().toString(36).slice(2,7)}`,type:e,value:n,sources:a?[a]:[],count:1,firstSeen:i,lastSeen:i}),setEntities(s),updateEntityCount(),"hivemind"===appState.activePanel&&renderEntityTable()},deleteEntity=e=>{const t=getEntities().filter(t=>t.id!==e);setEntities(t),updateEntityCount(),renderEntityTable(),showToast("Entity deleted.")},clearAllEntities=()=>{window.confirm("Clear all saved entities? This cannot be undone.")&&(localStorage.removeItem(STORAGE_KEYS.entities),updateEntityCount(),renderEntityTable(),showToast("All entities cleared."))},exportEntitiesJson=()=>{const e=getEntities();if(!e.length)return void showToast("No entities to export.","error");const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(t),a.download=`spin-entities-${formatDate((new Date).toISOString())}.json`,a.click(),URL.revokeObjectURL(a.href),showToast("Exported JSON.")},toCsvCell=e=>{const t=String(e??"");return/[,"\n]/.test(t)?`"${t.replace(/"/g,'""')}"`:t},exportEntitiesCsv=()=>{const e=getEntities();if(!e.length)return void showToast("No entities to export.","error");const t=[["type","value","sources","count","firstSeen","lastSeen"],...e.map(e=>[e.type,e.value,(e.sources||[]).join(" | "),e.count||1,e.firstSeen||"",e.lastSeen||""])].map(e=>e.map(toCsvCell).join(",")).join("\n"),a=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(a),s.download=`spin-entities-${formatDate((new Date).toISOString())}.csv`,s.click(),URL.revokeObjectURL(s.href),showToast("Exported CSV.")},importEntities=()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.addEventListener("change",e=>{const t=e.target.files?.[0];if(!t)return;const a=new FileReader;a.onload=()=>{const e=safeJsonParse(a.result,null);if(!Array.isArray(e))return void showToast("Invalid import file format.","error");const t=getEntities();let s=0;e.forEach(e=>{if(!e?.type||!e?.value)return;const a=normalizeEntityValue(e.type,e.value);t.some(t=>t.type===e.type&&t.value===a)||(t.push({id:e.id||`${Date.now().toString(36)}${Math.random().toString(36).slice(2,7)}`,type:e.type,value:a,sources:Array.isArray(e.sources)?e.sources:[],count:Number(e.count)>0?e.count:1,firstSeen:e.firstSeen||(new Date).toISOString(),lastSeen:e.lastSeen||(new Date).toISOString()}),s+=1)}),setEntities(t),updateEntityCount(),renderEntityTable(),showToast(`Imported ${s} new entities.`)},a.readAsText(t)}),e.click()},switchPanel=e=>{const t=qsa(".panel"),a=qsa(".nav-tab");appState.activePanel=e,localStorage.setItem(STORAGE_KEYS.activePanel,e),t.forEach(t=>{const a=t.id===e;t.classList.toggle("active",a),t.setAttribute("aria-hidden",String(!a)),t.toggleAttribute("hidden",!a)}),a.forEach(t=>{const a=t.dataset.panel===e;t.classList.toggle("active",a),t.setAttribute("aria-selected",String(a)),t.setAttribute("tabindex",a?"0":"-1")}),"hivemind"===e&&renderEntityTable()},initNavigation=()=>{const e=qsa(".nav-tab");e.forEach((t,a)=>{t.addEventListener("click",()=>switchPanel(t.dataset.panel)),t.addEventListener("keydown",t=>{const s=t.key;if(!["ArrowLeft","ArrowRight","Home","End"].includes(s))return;t.preventDefault();let n=a;"ArrowRight"===s&&(n=(a+1)%e.length),"ArrowLeft"===s&&(n=(a-1+e.length)%e.length),"Home"===s&&(n=0),"End"===s&&(n=e.length-1),e[n].focus(),switchPanel(e[n].dataset.panel)})}),qsa("[data-open-panel]").forEach(e=>{const t=()=>switchPanel(e.dataset.openPanel);e.addEventListener("click",t),e.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t())})});const t=localStorage.getItem(STORAGE_KEYS.activePanel);t&&byId(t)?switchPanel(t):switchPanel("dashboard")},applyTheme=e=>{const t="light"===e?"light":"dark";document.documentElement.dataset.theme=t,localStorage.setItem(STORAGE_KEYS.theme,t);const a=byId("theme-toggle");if(a){const e="dark"===t?"light":"dark";a.innerHTML=`<span aria-hidden="true">${"light"===e?"Light":"Dark"}</span>`,a.setAttribute("aria-label",`Switch to ${e} mode`),a.title=`Switch to ${e} mode`}},initTheme=()=>{const e=localStorage.getItem(STORAGE_KEYS.theme),t=window.matchMedia("(prefers-color-scheme: light)").matches;applyTheme(e||(t?"light":"dark")),byId("theme-toggle")?.addEventListener("click",()=>{const e="light"===document.documentElement.dataset.theme?"light":"dark";applyTheme("dark"===e?"light":"dark")})},buildJokeOrder=(e=-1)=>{const t=shuffle(JOKES.map((e,t)=>t));t[0]===e&&t.length>1&&([t[0],t[1]]=[t[1],t[0]]),appState.jokeOrder=t,appState.jokeCursor=-1},getNextJokeIndex=()=>((!appState.jokeOrder.length||appState.jokeCursor>=appState.jokeOrder.length-1)&&buildJokeOrder(appState.currentJokeIndex),appState.jokeCursor+=1,appState.currentJokeIndex=appState.jokeOrder[appState.jokeCursor],appState.currentJokeIndex),displayJoke=async({animate:e=!0}={})=>{const t=byId("joke-card"),a=byId("joke-text"),s=byId("joke-punchline"),n=byId("reveal-punchline-btn");if(!(t&&a&&s&&n))return;e&&(t.classList.remove("joke-transition-in"),t.classList.add("joke-transition-out"),await delay(120));const i=JOKES[getNextJokeIndex()];a.textContent=i.setup,s.textContent=i.punchline,s.classList.add("is-hidden"),n.textContent="Reveal Punchline",n.setAttribute("aria-pressed","false"),e&&(t.classList.remove("joke-transition-out"),t.classList.add("joke-transition-in"),setTimeout(()=>t.classList.remove("joke-transition-in"),260))},revealPunchline=()=>{const e=byId("joke-punchline"),t=byId("reveal-punchline-btn");e&&t&&(e.classList.remove("is-hidden"),t.textContent="Punchline Revealed",t.setAttribute("aria-pressed","true"))},initJokes=()=>{byId("new-joke-btn")?.addEventListener("click",async e=>{const t=e.currentTarget;t.disabled=!0,await displayJoke({animate:!0}),t.disabled=!1}),byId("reveal-punchline-btn")?.addEventListener("click",revealPunchline),displayJoke({animate:!1})},buildTipOrder=(e=-1)=>{const t=shuffle(TIPS.map((e,t)=>t));t[0]===e&&t.length>1&&([t[0],t[1]]=[t[1],t[0]]),appState.tipOrder=t,appState.tipCursor=-1},getNextTipIndex=()=>{if(!appState.tipOrder.length||appState.tipCursor>=appState.tipOrder.length-1){const e=appState.tipOrder[appState.tipCursor]??-1;buildTipOrder(e)}return appState.tipCursor+=1,appState.tipOrder[appState.tipCursor]},getPreviousTipIndex=()=>appState.tipOrder.length?(appState.tipCursor-=1,appState.tipCursor<0&&(appState.tipCursor=appState.tipOrder.length-1),appState.tipOrder[appState.tipCursor]):(buildTipOrder(),appState.tipCursor=0,appState.tipOrder[0]),displayTip=e=>{const t=byId("tip-ticker");t&&(t.classList.add("tip-fade"),setTimeout(()=>{t.textContent=e,t.classList.remove("tip-fade")},120))},nextTip=()=>displayTip(TIPS[getNextTipIndex()]),previousTip=()=>displayTip(TIPS[getPreviousTipIndex()]),setTickerPause=e=>{appState.tickerPaused=e;const t=byId("tip-pause-btn");t&&(t.textContent=e?"Resume":"Pause")},startTicker=()=>{appState.tickerInterval&&clearInterval(appState.tickerInterval),appState.tickerPaused||(appState.tickerInterval=setInterval(nextTip,7e3))},initTicker=()=>{nextTip(),setTickerPause(!1),startTicker(),byId("tip-next-btn")?.addEventListener("click",()=>{nextTip()}),byId("tip-prev-btn")?.addEventListener("click",()=>{previousTip()}),byId("tip-pause-btn")?.addEventListener("click",()=>{const e=!appState.tickerPaused;setTickerPause(e),startTicker()})},showRandomTipPopup=()=>{const e=byId("tip-popup"),t=byId("tip-popup-text");e&&t&&(t.textContent=TIPS[Math.floor(Math.random()*TIPS.length)],e.classList.add("show"),appState.tipPopupTimer&&clearTimeout(appState.tipPopupTimer),appState.tipPopupTimer=setTimeout(()=>e.classList.remove("show"),8e3))},closeTipPopup=()=>{byId("tip-popup")?.classList.remove("show"),appState.tipPopupTimer&&(clearTimeout(appState.tipPopupTimer),appState.tipPopupTimer=null)},validators={phone:e=>{const t=e.trim();if(!t)return{valid:!1,message:"Enter a phone number."};if(!/^\+?[0-9().\-\s]+$/.test(t))return{valid:!1,message:"Use digits with optional +, spaces, (), -, or ."};const a=t.replace(/[^\d]/g,"");return a.length<7||a.length>15?{valid:!1,message:"Phone numbers should contain 7 to 15 digits."}:{valid:!0,normalized:t.replace(/[\s().-]/g,"")}},email:e=>{const t=e.trim();if(!t)return{valid:!1,message:"Enter an email address."};return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?{valid:!0,normalized:t.toLowerCase()}:{valid:!1,message:"Use format like user@example.com."}},username:e=>{const t=e.trim();return t?/^[a-zA-Z0-9._-]{3,30}$/.test(t)?{valid:!0,normalized:t}:{valid:!1,message:"Use 3-30 characters: letters, numbers, dot, underscore, or hyphen."}:{valid:!1,message:"Enter a username."}},domain:e=>{const t=e.trim().replace(/^https?:\/\//i,"").split("/")[0];if(!t)return{valid:!1,message:"Enter a domain name."};return/^(?=.{1,253}$)(?!-)(?:[a-zA-Z0-9-]{1,63}\.)+[a-zA-Z]{2,63}$/.test(t)?{valid:!0,normalized:t.toLowerCase()}:{valid:!1,message:"Use a valid domain like example.com."}}},renderMessage=(e,t="error")=>`\n  <div class="result-item result-message ${t}">\n    <span class="result-value">${escapeHtml(e)}</span>\n  </div>\n`,maybeRenderHivemind=()=>{"hivemind"===appState.activePanel&&renderEntityTable()},analyzePhone=async()=>{const e=byId("phone-input"),t=byId("phone-results");if(!e||!t)return;const a=validators.phone(e.value);if(!a.valid)return setHint("phone-hint",a.message,"error"),void(t.innerHTML=renderMessage(a.message));setHint("phone-hint","Valid phone format. Running local analysis...","success"),renderLoading("phone-results","Analyzing phone number locally..."),await delay(320);const s=a.normalized,n=s.replace(/^\+/,""),i=Object.keys(COUNTRY_CODES).sort((e,t)=>t.length-e.length);let o="",r=n,l="Unknown";i.some(e=>!!n.startsWith(e)&&(o=`+${e}`,r=n.slice(e.length),l=COUNTRY_CODES[e].name,!0));const c=`${o||"+"}${r}`;let d="Unknown";if("+1"===o&&10===r.length){const e=r.slice(0,3);d=new Set(["800","888","877","866","855","844","833"]).has(e)?"Toll-Free":"900"===e?"Premium":"Standard Line"}const p=[{name:"Google",url:`https://www.google.com/search?q="${encodeURIComponent(e.value)}"`},{name:"DuckDuckGo",url:`https://duckduckgo.com/?q="${encodeURIComponent(e.value)}"`},{name:"Truecaller",url:`https://www.truecaller.com/search/${encodeURIComponent(s)}`}];t.innerHTML=`\n    <div class="result-item"><span class="result-label">Input</span><span class="result-value">${escapeHtml(e.value.trim())}</span></div>\n    <div class="result-item"><span class="result-label">E.164</span><span class="result-value">${escapeHtml(c)} <button class="copy-btn" data-copy="${escapeAttr(c)}">copy</button></span></div>\n    <div class="result-item"><span class="result-label">Country</span><span class="result-value">${escapeHtml(l)}</span></div>\n    <div class="result-item"><span class="result-label">Country Code</span><span class="result-value">${escapeHtml(o||"Not detected")}</span></div>\n    <div class="result-item"><span class="result-label">National</span><span class="result-value">${escapeHtml(r)}</span></div>\n    <div class="result-item"><span class="result-label">Line Type</span><span class="result-value">${escapeHtml(d)}</span></div>\n    <div class="result-item"><span class="result-label">Search</span><span class="result-value">${p.map(e=>`<a href="${e.url}" target="_blank" rel="noopener">${e.name}</a>`).join(" &middot; ")}</span></div>\n  `,saveEntity("phone",e.value,"Phone Analysis"),maybeRenderHivemind(),showToast("Phone analyzed and saved to Hivemind.")},analyzeEmail=async()=>{const e=byId("email-input"),t=byId("email-results");if(!e||!t)return;const a=validators.email(e.value);if(!a.valid)return setHint("email-hint",a.message,"error"),void(t.innerHTML=renderMessage(a.message));setHint("email-hint","Valid email format. Running local analysis...","success"),renderLoading("email-results","Analyzing email locally..."),await delay(320);const s=a.normalized,[n,i]=s.split("@"),o=i.split(".").pop(),r={"gmail.com":{name:"Google Gmail",type:"Free",disposable:!1},"outlook.com":{name:"Microsoft Outlook",type:"Free",disposable:!1},"hotmail.com":{name:"Microsoft Hotmail",type:"Free",disposable:!1},"protonmail.com":{name:"ProtonMail",type:"Encrypted",disposable:!1},"proton.me":{name:"ProtonMail",type:"Encrypted",disposable:!1},"mailinator.com":{name:"Mailinator",type:"Disposable",disposable:!0},"guerrillamail.com":{name:"Guerrilla Mail",type:"Disposable",disposable:!0},"10minutemail.com":{name:"10 Minute Mail",type:"Disposable",disposable:!0}}[i]||{name:"Custom/Business",type:"Business/Unknown",disposable:!1},l=[];/^\d+$/.test(n)&&l.push("Numeric local-part"),/^[a-z]+\.[a-z]+$/i.test(n)&&l.push("First.Last format"),n.length<4&&l.push("Very short local-part"),n.includes("+")&&l.push("Uses plus alias");const c=[{name:"Google",url:`https://www.google.com/search?q="${encodeURIComponent(s)}"`},{name:"DuckDuckGo",url:`https://duckduckgo.com/?q="${encodeURIComponent(s)}"`},{name:"Have I Been Pwned",url:`https://haveibeenpwned.com/account/${encodeURIComponent(s)}`}];t.innerHTML=`\n    <div class="result-item"><span class="result-label">Email</span><span class="result-value">${escapeHtml(s)} <button class="copy-btn" data-copy="${escapeAttr(s)}">copy</button></span></div>\n    <div class="result-item"><span class="result-label">Local Part</span><span class="result-value">${escapeHtml(n)}</span></div>\n    <div class="result-item"><span class="result-label">Domain</span><span class="result-value">${escapeHtml(i)}</span></div>\n    <div class="result-item"><span class="result-label">TLD</span><span class="result-value">.${escapeHtml(o)}</span></div>\n    <div class="result-item"><span class="result-label">Provider</span><span class="result-value">${escapeHtml(r.name)} <span class="tag ${r.disposable?"red":"green"}">${escapeHtml(r.type)}</span></span></div>\n    <div class="result-item"><span class="result-label">Disposable</span><span class="result-value">${r.disposable?'<span class="tag red">Likely disposable</span>':'<span class="tag green">No</span>'}</span></div>\n    <div class="result-item"><span class="result-label">Patterns</span><span class="result-value">${l.length?l.map(e=>`<span class="tag blue">${escapeHtml(e)}</span>`).join(" "):"No notable patterns"}</span></div>\n    <div class="result-item"><span class="result-label">Search</span><span class="result-value">${c.map(e=>`<a href="${e.url}" target="_blank" rel="noopener">${e.name}</a>`).join(" &middot; ")}</span></div>\n  `,saveEntity("email",s,"Email Analysis"),maybeRenderHivemind(),showToast("Email analyzed and saved to Hivemind.")},patternBadges=e=>{const t=[];return/^\d+$/.test(e)&&t.push("Numeric only"),e.length<4&&t.push("Short username"),e.length>20&&t.push("Long username"),/[._-]/.test(e)&&t.push("Contains separators"),/\d{4}$/.test(e)&&t.push("Year-like suffix"),t},updatePlatformStatus=(e,t,a)=>{const s=byId(`platform-status-${e}`);if(!s)return;const n={pending:"…",exists:"✓",missing:"✕",error:"⚠"}[t]||"";s.className=`platform-status ${t}`,s.textContent=`${n} ${a}`.trim()},parseRobots=e=>{const t=e.split(/\r?\n/).map(e=>e.trim()),a=[];let s=!1;return t.forEach(e=>{if(!e||e.startsWith("#"))return;const[t,...n]=e.split(":");if(!t||!n.length)return;const i=t.trim().toLowerCase(),o=n.join(":").trim();"user-agent"===i?s="*"===o||o.toLowerCase().includes("spin"):"disallow"===i&&s&&o&&a.push(o)}),a},checkRobotsAllowed=async e=>{try{const t=new URL(e);if(appState.robotsCache.has(t.origin)){const e=appState.robotsCache.get(t.origin);if(!e.available)return{allowed:!0};return e.rules.some(e=>t.pathname.startsWith(e))?{allowed:!1,reason:"Blocked by robots.txt rules."}:{allowed:!0}}const a=await fetchWithTimeout(`${t.origin}/robots.txt`,{},5e3);if(!a.ok)return appState.robotsCache.set(t.origin,{available:!1,rules:[]}),{allowed:!0};const s=await a.text(),n=parseRobots(s);appState.robotsCache.set(t.origin,{available:!0,rules:n});return n.some(e=>t.pathname.startsWith(e))?{allowed:!1,reason:"Blocked by robots.txt rules."}:{allowed:!0}}catch(e){return{allowed:!0}}},profileFetchCheck=async e=>{try{const t=await fetchWithTimeout(e,{method:"GET"},9e3);return 200===t.status?{status:"exists",message:"Reachable (200)"}:404===t.status?{status:"missing",message:"Not found (404)"}:{status:"error",message:`HTTP ${t.status}`}}catch(e){return{status:"error",message:"Unreachable from browser (CORS/network)"}}},runUsernameChecks=async e=>{if(appState.usernameChecksRunning)return;appState.usernameChecksRunning=!0;const t=byId("username-live-check-btn");t&&(t.disabled=!0),showToast("Running live checks. This will send the username to selected public platforms.","warn");for(const t of USERNAME_PLATFORMS){updatePlatformStatus(t.key,"pending","Checking..."),await delay(450);const a=t.profileUrl(e),s=await checkRobotsAllowed(a);if(s.allowed)try{markExternalRequest();const s=t.check?await t.check(e,a):await profileFetchCheck(a);updatePlatformStatus(t.key,s.status,s.message)}catch(e){updatePlatformStatus(t.key,"error",e?.message||"Check failed")}else updatePlatformStatus(t.key,"error",s.reason)}t&&(t.disabled=!1),appState.usernameChecksRunning=!1,showToast("Username checks completed.")},analyzeUsername=async()=>{const e=byId("username-input"),t=byId("username-results");if(!e||!t)return;const a=validators.username(e.value);if(!a.valid)return setHint("username-hint",a.message,"error"),void(t.innerHTML=renderMessage(a.message));setHint("username-hint","Username format looks good.","success"),renderLoading("username-results","Building platform matrix..."),await delay(280);const s=a.normalized,n=patternBadges(s),i=USERNAME_PLATFORMS.map(e=>{const t=e.profileUrl(s);return`\n      <div class="platform-check-card" id="platform-${e.key}">\n        <div class="platform-check-head">\n          <span class="platform-icon">${escapeHtml(e.icon)}</span>\n          <span class="platform-name">${escapeHtml(e.name)}</span>\n        </div>\n        <div class="platform-check-actions">\n          <span class="platform-status pending" id="platform-status-${e.key}">Queued</span>\n          <a href="${t}" target="_blank" rel="noopener">Open</a>\n        </div>\n      </div>\n    `}).join("");t.innerHTML=`\n    <div class="result-item"><span class="result-label">Username</span><span class="result-value">${escapeHtml(s)} <button class="copy-btn" data-copy="${escapeAttr(s)}">copy</button></span></div>\n    <div class="result-item"><span class="result-label">Length</span><span class="result-value">${s.length} characters</span></div>\n    <div class="result-item"><span class="result-label">Patterns</span><span class="result-value">${n.length?n.map(e=>`<span class="tag blue">${escapeHtml(e)}</span>`).join(" "):"Standard format"}</span></div>\n    <div class="result-item"><span class="result-label">Search</span><span class="result-value"><a href="https://www.google.com/search?q=%22${encodeURIComponent(s)}%22" target="_blank" rel="noopener">Google</a> &middot; <a href="https://duckduckgo.com/?q=%22${encodeURIComponent(s)}%22" target="_blank" rel="noopener">DuckDuckGo</a></span></div>\n    <div class="privacy-note">\n      Live checks are optional. No external requests are made until you click <strong>Run Live Checks</strong>.\n    </div>\n    <div class="btn-group" style="margin-bottom:0.75rem">\n      <button class="btn btn-sm" id="username-live-check-btn">Run Live Checks</button>\n    </div>\n    <div class="platform-check-grid">${i}</div>\n  `,byId("username-live-check-btn")?.addEventListener("click",()=>runUsernameChecks(s)),saveEntity("username",s,"Username Recon"),maybeRenderHivemind(),showToast("Username analyzed locally and saved to Hivemind.")},parseDomainParts=e=>{const t=e.split(".");return{tld:t[t.length-1]||"",sld:t.length>=2?t[t.length-2]:"",subdomain:t.length>2?t.slice(0,-2).join("."):""}},TLD_INFO={com:"Commercial",org:"Organization",net:"Network",edu:"Education",gov:"Government",io:"Tech",ai:"AI / Anguilla",dev:"Developer",app:"Application",me:"Personal",info:"Information",xyz:"Generic",uk:"United Kingdom",de:"Germany",fr:"France",jp:"Japan",in:"India",onion:"Tor Hidden Service"},runWhoisLookup=async e=>{const t=byId("domain-whois-live");if(t){renderLoading("domain-whois-live","Querying RDAP WHOIS...");try{markExternalRequest();const a=await fetchWithTimeout(`https://rdap.org/domain/${encodeURIComponent(e)}`,{headers:{Accept:"application/rdap+json, application/json"}});if(!a.ok)throw new Error(`WHOIS lookup failed (${a.status})`);const s=await a.json(),n=e=>s?.events?.find(t=>t.eventAction===e)?.eventDate||"-",i=s?.entities?.find(e=>Array.isArray(e.roles)&&e.roles.includes("registrar")),o=i?.vcardArray?.[1]?.find(e=>"fn"===e[0])?.[3]||"-",r=(s?.nameservers||[]).map(e=>e.ldhName).filter(Boolean),l=(s?.status||[]).slice(0,6);t.innerHTML=`\n      <div class="subresult-card">\n        <h4>WHOIS / RDAP</h4>\n        <div class="result-item"><span class="result-label">Handle</span><span class="result-value">${escapeHtml(s?.handle||"-")}</span></div>\n        <div class="result-item"><span class="result-label">Registrar</span><span class="result-value">${escapeHtml(o)}</span></div>\n        <div class="result-item"><span class="result-label">Created</span><span class="result-value">${escapeHtml(n("registration"))}</span></div>\n        <div class="result-item"><span class="result-label">Updated</span><span class="result-value">${escapeHtml(n("last changed"))}</span></div>\n        <div class="result-item"><span class="result-label">Expires</span><span class="result-value">${escapeHtml(n("expiration"))}</span></div>\n        <div class="result-item"><span class="result-label">Status</span><span class="result-value">${l.length?l.map(e=>`<span class="tag">${escapeHtml(e)}</span>`).join(" "):"-"}</span></div>\n        <div class="result-item"><span class="result-label">Nameservers</span><span class="result-value">${r.length?r.map(escapeHtml).join(", "):"-"}</span></div>\n      </div>\n    `}catch(e){t.innerHTML=renderMessage(e?.message||"WHOIS lookup failed.","error")}}},parseDnsAnswers=(e=[])=>Array.isArray(e)&&e.length?e.map(e=>`${e?.name||""} ${e?.TTL||""} ${e?.data||""}`.trim()):["No records"],runDnsLookup=async e=>{const t=byId("domain-dns-live");if(!t)return;renderLoading("domain-dns-live","Querying DNS records...");const a=["A","AAAA","MX","NS","TXT","CNAME"];try{const s=await Promise.all(a.map(async t=>{markExternalRequest();const a=await fetchWithTimeout(`https://dns.google/resolve?name=${encodeURIComponent(e)}&type=${encodeURIComponent(t)}`,{},1e4);if(!a.ok)return{type:t,records:[`Lookup failed (${a.status})`]};const s=await a.json();return{type:t,records:parseDnsAnswers(s?.Answer||[])}}));t.innerHTML=`\n      <div class="subresult-card">\n        <h4>DNS Records (Google DNS API)</h4>\n        ${s.map(e=>`\n              <div class="result-item">\n                <span class="result-label">${e.type}</span>\n                <span class="result-value">${e.records.map(e=>`<div>${escapeHtml(e)}</div>`).join("")}</span>\n              </div>\n            `).join("")}\n      </div>\n    `}catch(e){t.innerHTML=renderMessage(e?.message||"DNS lookup failed.","error")}},analyzeDomain=async()=>{const e=byId("domain-input"),t=byId("domain-results");if(!e||!t)return;const a=validators.domain(e.value);if(!a.valid)return setHint("domain-hint",a.message,"error"),void(t.innerHTML=renderMessage(a.message));setHint("domain-hint","Domain format looks good.","success"),renderLoading("domain-results","Analyzing domain locally..."),await delay(320);const s=a.normalized,n=parseDomainParts(s),i=[{name:"WHOIS (who.is)",url:`https://who.is/whois/${encodeURIComponent(s)}`},{name:"crt.sh",url:`https://crt.sh/?q=%25.${encodeURIComponent(s)}`},{name:"Wayback",url:`https://web.archive.org/web/*/${encodeURIComponent(s)}`},{name:"Shodan",url:`https://www.shodan.io/search?query=${encodeURIComponent(s)}`},{name:"VirusTotal",url:`https://www.virustotal.com/gui/domain/${encodeURIComponent(s)}`}];t.innerHTML=`\n    <div class="result-item"><span class="result-label">Domain</span><span class="result-value">${escapeHtml(s)} <button class="copy-btn" data-copy="${escapeAttr(s)}">copy</button></span></div>\n    ${n.subdomain?`<div class="result-item"><span class="result-label">Subdomain</span><span class="result-value">${escapeHtml(n.subdomain)}</span></div>`:""}\n    <div class="result-item"><span class="result-label">SLD</span><span class="result-value">${escapeHtml(n.sld||"-")}</span></div>\n    <div class="result-item"><span class="result-label">TLD</span><span class="result-value">.${escapeHtml(n.tld)} <span class="tag">${escapeHtml(TLD_INFO[n.tld]||"Unknown")}</span></span></div>\n    <div class="result-item"><span class="result-label">Visit</span><span class="result-value"><a href="https://${escapeAttr(s)}" target="_blank" rel="noopener">https://${escapeHtml(s)}</a></span></div>\n    <div class="result-item"><span class="result-label">Recon Links</span><span class="result-value">${i.map(e=>`<a href="${e.url}" target="_blank" rel="noopener">${e.name}</a>`).join(" &middot; ")}</span></div>\n    <div class="privacy-note">\n      Local parsing completed. Live WHOIS/DNS lookups are optional and only run when you click below.\n    </div>\n    <div class="btn-group" style="margin-bottom:0.75rem">\n      <button class="btn btn-sm" id="domain-whois-btn">Load WHOIS (live)</button>\n      <button class="btn btn-sm" id="domain-dns-btn">Load DNS (live)</button>\n    </div>\n    <div id="domain-whois-live"></div>\n    <div id="domain-dns-live"></div>\n  `,byId("domain-whois-btn")?.addEventListener("click",()=>runWhoisLookup(s)),byId("domain-dns-btn")?.addEventListener("click",()=>runDnsLookup(s)),saveEntity("domain",s,"Domain Recon"),maybeRenderHivemind(),showToast("Domain analyzed locally and saved to Hivemind.")},extractEntities=()=>{const e=byId("extract-input"),t=byId("extract-results");if(!e||!t)return;const a=e.value;if(!a.trim())return void(t.innerHTML=renderMessage("Paste text to extract entities.","error"));const s=[],n=(e,t,n=e=>e)=>{(a.match(t)||[]).forEach(t=>s.push({type:e,value:n(t)}))};n("email",/[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}/g),n("phone",/(?:\+?\d[\d\s().-]{6,}\d)/g,e=>e.trim()),n("ipv4",/\b(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\b/g),n("domain",/\b(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+(?:com|org|net|edu|gov|mil|io|co|ai|dev|app|me|info|biz|xyz|tech|online|uk|de|fr|ru|cn|jp|br|in|onion)\b/g),n("url",/https?:\/\/[^\s<>"{}|\\^`\[\]]+/g),n("bitcoin",/\b(?:[13][a-km-zA-HJ-NP-Z1-9]{25,34}|bc1[a-zA-HJ-NP-Z0-9]{25,39})\b/g),n("ethereum",/\b0x[a-fA-F0-9]{40}\b/g),n("hashtag",/#[a-zA-Z]\w{1,50}/g),n("username",/@[a-zA-Z]\w{1,30}/g,e=>e.slice(1));const i=new Map;s.forEach(e=>{const t=`${e.type}:${e.value}`;i.has(t)||i.set(t,e)});const o=Array.from(i.values());if(!o.length)return void(t.innerHTML='<div class="empty-state"><p>No entities found in the provided text.</p></div>');const r={email:"",phone:"green",ipv4:"orange",domain:"blue",url:"blue",bitcoin:"yellow",ethereum:"yellow",hashtag:"",username:"green"};t.innerHTML=`\n    <p style="margin-bottom:8px;color:var(--text-dim);font-size:0.85rem">\n      Found <strong style="color:var(--spin-green)">${o.length}</strong> entities\n    </p>\n    <div class="extracted-list">\n      ${o.map(e=>`\n            <div class="extracted-item">\n              <span class="tag ${r[e.type]||""}">${escapeHtml(e.type)}</span>\n              <span class="result-value" style="flex:1">${escapeHtml(e.value)}</span>\n              <button class="copy-btn" data-copy="${escapeAttr(e.value)}">copy</button>\n              <button class="btn btn-sm btn-green" data-save-type="${escapeAttr(e.type)}" data-save-value="${escapeAttr(e.value)}">save</button>\n            </div>\n          `).join("")}\n    </div>\n  `,showToast(`Extracted ${o.length} entities.`)},sortEntities=(e,t)=>{const a=e.slice(),s=(e,t)=>e.localeCompare(t,void 0,{sensitivity:"base"});switch(t){case"alpha-asc":return a.sort((e,t)=>s(e.value,t.value));case"alpha-desc":return a.sort((e,t)=>s(t.value,e.value));case"type-asc":return a.sort((e,t)=>s(e.type,t.type));case"type-desc":return a.sort((e,t)=>s(t.type,e.type));case"date-asc":return a.sort((e,t)=>new Date(e.firstSeen||e.lastSeen||0).getTime()-new Date(t.firstSeen||t.lastSeen||0).getTime());default:return a.sort((e,t)=>new Date(t.firstSeen||t.lastSeen||0).getTime()-new Date(e.firstSeen||e.lastSeen||0).getTime())}},renderEntityTable=()=>{const e=byId("entity-table-body");if(!e)return;const t=byId("entity-filter")?.value||"all",a=(byId("entity-search")?.value||"").toLowerCase().trim(),s=(byId("entity-source-filter")?.value||"").toLowerCase().trim(),n=byId("entity-sort")?.value||"date-desc";let i=getEntities();if("all"!==t&&(i=i.filter(e=>e.type===t)),a&&(i=i.filter(e=>e.value.toLowerCase().includes(a)||e.type.toLowerCase().includes(a)||(e.sources||[]).join(" ").toLowerCase().includes(a))),s&&(i=i.filter(e=>(e.sources||[]).join(" ").toLowerCase().includes(s))),i=sortEntities(i,n),!i.length){const t=getEntities().length;return void(e.innerHTML=`<tr><td colspan="6" class="empty-state" style="padding:2rem"><p>${t?"No matching entities for the selected filters.":"No entities yet. Use the tools to populate Hivemind."}</p></td></tr>`)}const o={email:"",phone:"green",ipv4:"orange",domain:"blue",url:"blue",bitcoin:"yellow",ethereum:"yellow",hashtag:"",username:"green"};e.innerHTML=i.map(e=>`\n        <tr>\n          <td><span class="tag ${o[e.type]||""}">${escapeHtml(e.type)}</span></td>\n          <td class="mono">${escapeHtml(e.value)}</td>\n          <td>${escapeHtml((e.sources||[]).join(", ")||"-")}</td>\n          <td>${e.count||1}</td>\n          <td>${escapeHtml(formatDate(e.firstSeen||e.lastSeen))}</td>\n          <td>\n            <button class="copy-btn" data-copy="${escapeAttr(e.value)}">copy</button>\n            <button class="copy-btn danger-btn" data-delete-entity="${escapeAttr(e.id)}">del</button>\n          </td>\n        </tr>\n      `).join("")},renderBookmarks=()=>{const e=byId("bookmarks-container");if(!e)return;const t=(byId("bookmark-search")?.value||"").toLowerCase().trim();let a="";Object.entries(BOOKMARKS).forEach(([e,s])=>{const n=t?s.filter(a=>a.name.toLowerCase().includes(t)||a.desc.toLowerCase().includes(t)||e.toLowerCase().includes(t)):s;n.length&&(a+=`<div class="bookmark-category">${escapeHtml(e)}</div><div class="bookmark-grid">`,n.forEach(e=>{a+=`\n        <div class="bookmark-item">\n          <a href="${e.url}" target="_blank" rel="noopener">${escapeHtml(e.name)}</a>\n          <div class="bookmark-desc">${escapeHtml(e.desc)}</div>\n        </div>\n      `}),a+="</div>")}),e.innerHTML=a||'<div class="empty-state"><p>No matching bookmarks.</p></div>'},rotateTagline=()=>{const e=byId("header-tagline");if(!e)return;const t=TAGLINES[Math.floor(Math.random()*TAGLINES.length)];e.style.opacity="0",setTimeout(()=>{e.textContent=t,e.style.opacity="1"},220)},rotateFooterJoke=()=>{const e=byId("footer-joke");e&&(e.textContent=FOOTER_JOKES[Math.floor(Math.random()*FOOTER_JOKES.length)])},generateCaseNumber=()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="CASE #";for(let a=0;a<6;a+=1)t+=e[Math.floor(36*Math.random())];byId("case-number").textContent=t},generateSessionId=()=>{const e=`SPN-${Date.now().toString(36).toUpperCase()}-${Math.random().toString(36).slice(2,6).toUpperCase()}`;byId("session-id").textContent=e},runLoadingSequence=()=>{const e=byId("loading-status"),t=byId("loading-screen");if(!e||!t)return;const a=shuffle(LOADING_MESSAGES);let s=0;const n=setInterval(()=>{s>=a.length||(e.textContent=a[s],s+=1)},320);setTimeout(()=>{clearInterval(n),e.textContent="Systems online. Welcome, detective.",setTimeout(()=>t.classList.add("hidden"),380)},2100)},registerServiceWorker=()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js").catch(()=>{})},canvasRoundRect=(e,t,a,s,n,i)=>{e.roundRect?e.roundRect(t,a,s,n,i):(e.moveTo(t+i,a),e.lineTo(t+s-i,a),e.quadraticCurveTo(t+s,a,t+s,a+i),e.lineTo(t+s,a+n-i),e.quadraticCurveTo(t+s,a+n,t+s-i,a+n),e.lineTo(t+i,a+n),e.quadraticCurveTo(t,a+n,t,a+n-i),e.lineTo(t,a+i),e.quadraticCurveTo(t,a,t+i,a),e.closePath())},generateAppleTouchIcon=()=>{try{const e=document.createElement("canvas");e.width=180,e.height=180;const t=e.getContext("2d");if(!t)return;t.fillStyle="#08080d",t.beginPath(),canvasRoundRect(t,0,0,180,180,36),t.fill();const a=t.createLinearGradient(0,0,180,180);a.addColorStop(0,"rgba(123, 31, 235, 0.2)"),a.addColorStop(1,"rgba(28, 223, 102, 0.2)"),t.fillStyle=a,t.beginPath(),canvasRoundRect(t,6,6,168,168,32),t.fill(),t.fillStyle="#ffffff",t.font="900 100px system-ui, -apple-system, sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillText("S",90,95);const s=document.createElement("link");s.rel="apple-touch-icon",s.href=e.toDataURL("image/png"),document.head.appendChild(s)}catch(e){}},isIOS=()=>/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,isStandalone=()=>!0===window.navigator.standalone||window.matchMedia("(display-mode: standalone)").matches,isInstallDismissed=()=>"1"===localStorage.getItem(STORAGE_KEYS.installDismissed),setInstallBannerVisible=e=>{const t=byId("install-banner");t&&(t.classList.toggle("show",e),document.body.classList.toggle("install-banner-visible",e))},dismissInstallBanner=()=>{setInstallBannerVisible(!1),localStorage.setItem(STORAGE_KEYS.installDismissed,"1")},triggerInstall=async()=>{appState.deferredInstallPrompt&&(appState.deferredInstallPrompt.prompt(),await appState.deferredInstallPrompt.userChoice,appState.deferredInstallPrompt=null)},showInstallBannerIOS=()=>{if(!isIOS()||isStandalone()||isInstallDismissed())return;const e=byId("install-steps");e&&(e.innerHTML='<div class="step"><span class="step-num">1</span> Tap the share button in Safari</div><div class="step"><span class="step-num">2</span> Tap <strong>Add to Home Screen</strong></div><div class="step"><span class="step-num">3</span> Tap <strong>Add</strong></div>',setTimeout(()=>setInstallBannerVisible(!0),3500))},initInstallBanner=()=>{window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),appState.deferredInstallPrompt=e,isStandalone()||isInstallDismissed()||(byId("install-btn").style.display="",byId("install-steps").innerHTML='<div class="step"><span class="step-num">&#10003;</span> Tap <strong>Install</strong> for a standalone, offline-friendly app.</div>',setTimeout(()=>setInstallBannerVisible(!0),2e3))}),window.addEventListener("appinstalled",()=>{appState.deferredInstallPrompt=null,dismissInstallBanner(),showToast("Spin Web installed.")}),showInstallBannerIOS()},updateSecurityStatus=()=>{const e=byId("sec-connection"),t=byId("sec-storage"),a=byId("sec-dnt"),s=byId("sec-cookies"),n=byId("sec-data-out");if(e){const t="https:"===location.protocol;e.querySelector(".sec-cell-indicator").className="sec-cell-indicator "+(t?"green":"orange"),e.querySelector(".sec-cell-value").textContent=t?"HTTPS":"HTTP"}if(n){const e=appState.externalRequests>0;n.querySelector(".sec-cell-indicator").className="sec-cell-indicator "+(e?"orange":"green"),n.querySelector(".sec-cell-value").textContent=e?`OPT-IN (${appState.externalRequests})`:"ZERO"}if(t){let e=0;try{Object.keys(localStorage).forEach(t=>{e+=2*(localStorage.getItem(t)||"").length})}catch(t){e=0}const a=e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`;t.querySelector(".sec-cell-value").textContent=a,t.querySelector(".sec-cell-indicator").className="sec-cell-indicator "+(e>4194304?"orange":"green")}if(a){const e=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,t="1"===e||"yes"===e;a.querySelector(".sec-cell-indicator").className="sec-cell-indicator "+(t?"green":"orange"),a.querySelector(".sec-cell-value").textContent=t?"ON":"OFF"}if(s){const e=navigator.cookieEnabled;s.querySelector(".sec-cell-indicator").className="sec-cell-indicator "+(e?"orange":"green"),s.querySelector(".sec-cell-value").textContent=e?"ENABLED":"BLOCKED"}},updateSessionUptime=()=>{const e=byId("sec-uptime");if(!e)return;const t=Math.floor((Date.now()-appState.sessionStart)/1e3),a=Math.floor(t/3600),s=Math.floor(t%3600/60),n=t%60;e.querySelector(".sec-cell-value").textContent=a>0?`${pad2(a)}:${pad2(s)}:${pad2(n)}`:`${pad2(s)}:${pad2(n)}`},initSecurityDashboard=()=>{updateSecurityStatus(),updateSessionUptime(),setInterval(updateSessionUptime,1e3),setInterval(updateSecurityStatus,3e4)},resetInputAndOutput=(e,t,a)=>{const s=byId(e),n=byId(t);s&&(s.value=""),n&&(n.innerHTML=""),a&&setHint(a,"","info"),s?.focus()},bindToolActions=()=>{byId("phone-analyze-btn")?.addEventListener("click",analyzePhone),byId("email-analyze-btn")?.addEventListener("click",analyzeEmail),byId("username-analyze-btn")?.addEventListener("click",analyzeUsername),byId("domain-analyze-btn")?.addEventListener("click",analyzeDomain),byId("extract-btn")?.addEventListener("click",extractEntities),byId("phone-reset-btn")?.addEventListener("click",()=>resetInputAndOutput("phone-input","phone-results","phone-hint")),byId("email-reset-btn")?.addEventListener("click",()=>resetInputAndOutput("email-input","email-results","email-hint")),byId("username-reset-btn")?.addEventListener("click",()=>resetInputAndOutput("username-input","username-results","username-hint")),byId("domain-reset-btn")?.addEventListener("click",()=>resetInputAndOutput("domain-input","domain-results","domain-hint")),byId("extract-reset-btn")?.addEventListener("click",()=>resetInputAndOutput("extract-input","extract-results"));[{id:"phone-input",fn:analyzePhone},{id:"email-input",fn:analyzeEmail},{id:"username-input",fn:analyzeUsername},{id:"domain-input",fn:analyzeDomain}].forEach(({id:e,fn:t})=>{byId(e)?.addEventListener("keydown",e=>{"Enter"===e.key&&t()})}),byId("phone-input")?.addEventListener("input",()=>{const e=byId("phone-input").value.trim();if(!e)return setHint("phone-hint","Tip: include country code for best results.","info");const t=validators.phone(e);setHint("phone-hint",t.message||"Looks good.",t.valid?"success":"error")}),byId("email-input")?.addEventListener("input",()=>{const e=byId("email-input").value.trim();if(!e)return setHint("email-hint","Tip: use a full address like user@example.com.","info");const t=validators.email(e);setHint("email-hint",t.message||"Looks good.",t.valid?"success":"error")}),byId("username-input")?.addEventListener("input",()=>{const e=byId("username-input").value.trim();if(!e)return setHint("username-hint","Tip: 3-30 characters, letters/numbers/._-","info");const t=validators.username(e);setHint("username-hint",t.message||"Looks good.",t.valid?"success":"error")}),byId("domain-input")?.addEventListener("input",()=>{const e=byId("domain-input").value.trim();if(!e)return setHint("domain-hint","Tip: use a domain like example.com.","info");const t=validators.domain(e);setHint("domain-hint",t.message||"Looks good.",t.valid?"success":"error")})},bindHivemindActions=()=>{byId("entity-import-btn")?.addEventListener("click",importEntities),byId("entity-export-json-btn")?.addEventListener("click",exportEntitiesJson),byId("entity-export-csv-btn")?.addEventListener("click",exportEntitiesCsv),byId("entity-clear-btn")?.addEventListener("click",clearAllEntities);const e=debounce(renderEntityTable,120);["entity-filter","entity-sort"].forEach(e=>byId(e)?.addEventListener("change",renderEntityTable)),["entity-search","entity-source-filter"].forEach(t=>byId(t)?.addEventListener("input",e))},bindBookmarkSearch=()=>{byId("bookmark-search")?.addEventListener("input",debounce(renderBookmarks,150))},bindDelegatedActions=()=>{document.addEventListener("click",e=>{const t=e.target.closest("[data-copy]");if(t)return void copyToClipboard(t.getAttribute("data-copy"));const a=e.target.closest("[data-save-type][data-save-value]");if(a)return saveEntity(a.getAttribute("data-save-type"),a.getAttribute("data-save-value"),"Text Extract"),maybeRenderHivemind(),void showToast("Saved to Hivemind.");const s=e.target.closest("[data-delete-entity]");s&&deleteEntity(s.getAttribute("data-delete-entity"))})},initRuntimeTimers=()=>{rotateTagline(),rotateFooterJoke(),setInterval(rotateTagline,1e4),setInterval(rotateFooterJoke,15e3),setTimeout(()=>{showRandomTipPopup(),setInterval(showRandomTipPopup,45e3)},2e4)},initApp=()=>{runLoadingSequence(),registerServiceWorker(),generateAppleTouchIcon(),initTheme(),initNavigation(),initJokes(),initTicker(),initInstallBanner(),initSecurityDashboard(),initRuntimeTimers(),bindToolActions(),bindHivemindActions(),bindBookmarkSearch(),bindDelegatedActions(),renderBookmarks(),renderEntityTable(),updateEntityCount(),generateCaseNumber(),generateSessionId()};window.closeTipPopup=closeTipPopup,window.dismissInstallBanner=dismissInstallBanner,window.triggerInstall=triggerInstall,window.nextJoke=()=>displayJoke({animate:!0}),window.switchPanel=switchPanel,document.addEventListener("DOMContentLoaded",initApp);